# Подготовка к работе

1. Штатным образом выполните подключение к FortiGate и извлеките файл конфигурации в формате `*.conf`.
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `convert_forti_to_c4.py`, разместив содержимое в любой каталог на рабочем месте (РМ) администратора.

>**Внимание:** Запуск скрипта `convert_forti_to_c4.py` может выполняться как на рабочем месте администратора с установленным менеджером конфигурации (МК), так и на стороннем рабочем месте. Если скрипт `convert_forti_to_c4.py` и МК находятся на разных РМ подразумевается, то сгенерированные файлы для импорта в МК необходимо будет перенести на РМ с установленным МК.

# Алгоритм работы

1. Запустите командную строку.
2. В командной строке перейдите в каталог, где распакован скрипт `convert_forti_to_c4.py`.
3. Запустите скрипт с помощью команды `python convert_forti_to_c4.py`.
4. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
5. Следуя инструкции, укажите путь до файла c конфигурацией `*.сonf` (INPUT).
6. Следуя инструкции, укажите путь до папки для сохранения преобразованного файла (OUTPUT_PATH).
7. При необходимости Вы можете сохранить копию лога работы со скриптом преобразования правил (LOG_FILE).
8. При необходимости Вы можете скорректировать стандартное имя для преобразованного файла (NAME).
9. После ввода параметров согласно пунктам 5 - 11 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
10. Убедитесь, что по окончанию работы скрипта сгенерирован отчет о преобразовании объектов разных типов, включая правила, в командной строке.
11. Убедитесь, что по окончанию работы скрипта в папке для сохранения преобразованного файла лежит два файла:
    - файл, содержащий конфигурацию в универсальном формате *.json; 
    - отчет о результате операции импорта.

>**Примечание:** Если путь в параметрах не указан, файл с копией лога будет сохранен в директории, в которой скрипт был запущен. 

# Алгоритм импорта правил из различных систем в КБ "Континент. Версия 4" (далее – К4) через МК

1. Запустите МК.
2. Выполните подключение к ЦУС.
3. Перейдите в раздел "Контроль доступа – Межсетевой экран".
4. В пустой области секции "Межсетевой экран" используйте пункт "Импортировать" контекстного меню.
5. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
6. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_forti_to_c4.py`.
7. Нажмите кнопку "Открыть".
8. Дождитесь окончания импорта.
9. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
10. Ознакомьтесь с результатами выполнения импорта.
11. Перейдите в раздел "Контроль доступа – Трансляция сетевых адресов".
12. В пустой области секции "Трансляция сетевых адресов" используйте пункт "Импортировать" контекстного меню.
13. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
14. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_forti_to_c4.py`.
15. Нажмите кнопку "Открыть".
16. Дождитесь окончания импорта.
17. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
18. Ознакомьтесь с результатами выполнения импорта.

## Просмотр детальной информации о результатах импорта

1. Перейдите в раздел "Администрирование – Задачи".
2. Выберите в списке задачу "Импорт политики контроля доступа", соответствующую времени запуска и окончания импорта.
3. В окне "Информация" будет представлен отчет, содержащем сообщения о результатах операции импорта. Если окно не отображается, перейдите на вкладку "Вид" и активируйте кнопку "Информация". 

## Замечания для правил фильтрации

1. Все импортированные правила на стороне К4 будут отключены.
2. Если в качестве "Source" на стороне FortiGate не указано ни одного сетевого объекта, на стороне К4 для "Отправителя" будет установлено значение "Любой" / "Any".
3. Если в качестве "Destination" на стороне FortiGate не указано ни одного сетевого объекта, на стороне К4 для "Получателя" будет установлено значение "Любой" / "Any".
4. Если в качестве "Service" на стороне FortiGate не указано ни одного объекта, на стороне К4 для "Сервиса" будет установлено значение "Любой" / "Any".
5. Если в качестве "Schedule" на стороне FortiGate не указано ни одного объекта, на стороне К4 для "Временного интервала" будет установлено значение "Всегда" / "Always".
6. При импорте правил из FortiGate в К4 параметр "Действие" / "Action" переносится согласно следующим правилам:
    - если в качестве "Action" на стороне FortiGate указано значение "Accept", на стороне К4 для "Действия" будет установлено значение "Пропустить" / "Accept";
    - в остальных случаях на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Block".
7. В К4 не переносятся параметры: `srcintf`, `dstintf`, `ssl-ssh-profile`, `utm-status`, `av-profile`, "webfilter-profile", "dnsfilter-profile", "file-filter-profile", "ips-sensor", "application-list", "wccp", "captive-portal-exempt", "inspection-mode".

- При импорте правил из FortiGate в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию):
 - Профиль Web/FTP фильтрации;
 - Приложение;
 - СОВ.

- При импорте правил из FortiGate в К4 не осуществляется перенос сетевых объектов, тип которых отличается от `iprange`, `subnet`, `vip`, `vipgrp`, `interface-subnet`.

- При импорте правил из FortiGate в К4 не осуществляется перенос временных объектов из раздела "firewall schedule group".

- При импорте правил из FortiGate в К4 не осуществляется перенос сервисов с протоколами 0 / 41 / 43 / 44 / 45 / 46 / 50 / 51 / 58 / 59 / 60.

- При импорте правил из FortiGate в К4 не осуществляется перенос сервисов, протокол которых отличается от icmp, ip, tcp, udp.

- Для сетевых объектов типа `interface-subnet` при импорте правил из FortiGate в К4 не осуществляется перенос параметра "interface".

- Для сетевых объектов типа `subnet` при импорте правил из FortiGate в К4 не осуществляется перенос параметров: "allow-routing", "associated-interface".

- Для сервисов типа `icmp` при импорте правил из FortiGate в К4 не осуществляется перенос параметра "visibility".

- Не осуществляется перенос сервисов типа `icmp`, если их тип и код не входят в перечень поддерживаемых.

# Приложения

К инструменту прилагаются следующие материалы:

- `c4_unified_json.svg` - описание структуры (схема) импортируемых данных.
