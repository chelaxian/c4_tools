# Подготовка к работе

1. Выполните экспорт конфигурации с помощью Универсального коннектора, выбрав профиль выгрузки "Экспорт в К4" (файл c правилами и объектами в формате `*.xml`).
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `convert_c3_to_c4.py`, разместив содержимое в любой каталог на рабочем месте (РМ) администратора.

>**Внимание:** Запуск скрипта `convert_c3_to_c4.py` может выполняться как на рабочем месте администратора с установленным менеджером конфигурации (МК), так и на стороннем рабочем месте. Если скрипт `convert_c3_to_c4.py` и МК находятся на разных РМ подразумевается, то сгенерированные файлы для импорта в МК необходимо будет перенести на РМ с установленным МК.

# Алгоритм работы

1. Запустите командную строку.
2. В командной строке перейдите в каталог, где распакован скрипт `convert_c3_to_c4.py`.
3. Запустите скрипт с помощью команды `python convert_c3_to_c4.py`.
4. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
5. Следуя инструкции, укажите путь до файла c правилами и объектами для преобразования в формате `*.xml` (INPUT).
6. Следуя инструкции, укажите путь до папки для сохранения преобразованного файла (OUTPUT_PATH).
7. При необходимости Вы можете сохранить копию лога работы со скриптом преобразования правил (LOG).
8. При необходимости Вы можете скорректировать стандартное имя для преобразованного файла (NAME).
9. После ввода параметров согласно пунктам 5 - 8 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
10. Убедитесь, что по окончанию работы скрипта сгенерирован отчет о преобразовании объектов разных типов, включая правила, в командной строке.
11. Убедитесь, что по окончанию работы скрипта в папке для сохранения преобразованного файла лежит два файла:
    - файл, содержащий конфигурацию в универсальном формате `*.json`; 
    - отчет о результате операции импорта.

>**Примечание:** Если путь в параметрах не указан, файл с копией лога будет сохранен в директории, в которой скрипт был запущен. 

# Алгоритм импорта правил из различных систем в КБ "Континент. Версия 4" (далее – К4) через МК

1. Запустите МК.
2. Выполните подключение к ЦУС.
3. Перейдите в раздел "Контроль доступа – Межсетевой экран".
4. В пустой области секции "Межсетевой экран" используйте пункт "Импортировать" контекстного меню.
5. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
7. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированных ранее скриптом `convert_c3_to_c4.py`.
8. Нажмите кнопку "Открыть".
9. Дождитесь окончания импорта.
10. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
11. Ознакомьтесь с результатами выполнения импорта.
12. Перейдите в раздел "Контроль доступа – Трансляция сетевых адресов".
13. В пустой области секции "Трансляция сетевых адресов" используйте пункт "Импортировать" контекстного меню.
14. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
15. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированных ранее скриптом `convert_c3_to_c4.py`.
16. Нажмите кнопку "Открыть".
17. Дождитесь окончания импорта.
18. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
19. Ознакомьтесь с результатами выполнения импорта.

## Для просмотра детальной информации о результатах импорта необходимо

1. Перейдите в раздел "Администрирование – Задачи".
2. Выберите в списке задачу "Импорт политики контроля доступа", соответствующую времени запуска и окончания импорта.
3. В окне "Информация" будет представлен отчет, содержащем сообщения о результатах операции импорта. Если окно не отображается, перейдите на вкладку "Вид" и активируйте кнопку "Информация".

## Замечания для правил фильтрации

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от установленного значения параметра "Отключено (Правило вкл/откл)" в АПКШ «Континент. Версия 3.9» (далее – К3).
2. В описании каждого правила будут отражены следующие параметры:
    - описание объекта системы из К3;
    - значения параметров, которые не переносятся из К3 в К4 или каким либо-образом трансформируются;
    - информация о наличии связей между объектами системы и сетевыми устройствами.
3. Если в качестве "Отправителя" на стороне К3 не указано ни одного сетевого объекта или указана группа пользователей, на стороне К4 для «Отправителя» будет установлено значение "Любой" / "Any".
4. Если в качестве "Получателя" на стороне К3 не указано ни одного сетевого объекта или указана группа пользователей, на стороне К4 для «Получателя» будет установлено значение "Любой" / "Any".
5. Если в качестве "Сервиса" на стороне К3 не указано ни одного объекта, на стороне К4 для "Сервиса" будет установлено значение "Любой" / "Any".
6. Если в качестве "Временного интервала" на стороне К3 не указано ни одного объекта, на стороне К4 для "Временного интервала" будет установлено значение "Всегда" / "Always".
7. В К4 не переносятся следующие параметры: 
    - Класс трафика;
    - Профиль усиленной фильтрации;
    - Профиль контроля приложений;
    - Реакции на события;
    - Контролировать состояние соединений;
    - Защита от DoS атак;
    - Применить и завершить обработку.
8. При импорте правил из К3 в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию): 
    - Профиль Web/FTP фильтрации;
    - Приложение;
    - СОВ.
9. При импорте правил из К3 в К4 параметр "Регистрация" для правил переносится с ограничениями. Логирование для правил на стороне К4 будет автоматически включено только в тех случаях, если на стороне К3 в качестве характеристики регистрации установлены значения "Первые 64 бита" и "Тело пакета". При прочих значениях для правил фильтрации на стороне К4 логирование не будет включено автоматически.
10. Для сетевых объектов при импорте правил из К3 в К4 не осуществляется перенос следующих параметров: 
    - Unicast/Multicast;
    - Тип привязки;
    - Регистрация.

## Замечания для правил трансляции

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от оригинального значения параметра "Отключено (Правило вкл/откл)" в К3.
2. В описании каждого правила будут отражены следующие параметры:
    - описание объекта системы из К3;
    - значения параметров, которые не переносятся из К3 в К4 или каким либо-образом трансформируются;
    - информация о наличии связей между объектами системы и сетевыми устройствами.
3. При импорте правил из К3 в К4 параметр "Направление" переносится согласно следующим правилам:
    - если в качестве "Направления" на стороне К3 указано значение "Исходящие" / "Outbound", на стороне К4 для "Действия" будет установлено значение "Отправителя" / "Source";
    - если в качестве "Направления" на стороне К3 указано значение "Входящие" / "Inbound", на стороне К4 для "Действия" будет установлено значение "Получателя" / "Destination";
    - если в качестве "Направления" на стороне К3 указано значение "Отобразить 1:1" / "Both", на стороне К4 для "Действия" будет установлено значение "Отобразить" / "One to one".
4. В К4 не переносятся следующие параметры: 
    - Временной интервал;
    - Класс трафика;
    - Регистрация;
    - Трансляция FTP;
    - Интерфейс;
    - Реакции на события.
5. Если для правила трансляции на стороне К3 выбрано более одного сервиса, на стороне К4 для каждого нового сервиса будет создана копия оригинального правила.
6. Для сетевых объектов при импорте правил из К3 в К4 не осуществляется перенос следующих параметров: 
    - Unicast/Multicast;
    - Тип привязки;
    - Регистрация.
7. Для предоставления доступа в Интернет сетевым объектам, содержащимся в импортированных правилах трансляции, на стороне К4 необходимо создать соответствующие правила фильтрации.

>**Примечание:** При работе с К3 для правил трансляции с направлением "Исходящие" / "Outbound" или "Входящие" / "Inbound" дополнительно автоматически создаются правила фильтрации. Эти правила фильтрации не попадают в экспортируемую конфигурацию, получаемую с помощью Универсального коннектора (файл c правилами и объектами в формате `*.xml`).
