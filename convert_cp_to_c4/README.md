# Подготовка к работе

1. Выполните подключение к Check Point по SFTP и скачайте файлы конфигурации в кодировке UTF-8 (файлы с правилами в формате `*.fws` и объектами в формате `*.с`).
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `convert_cp_to_c4.py`, разместив содержимое в любой каталог на рабочем месте (РМ) администратора.

>**Внимание:** Запуск скрипта `convert_cp_to_c4.py` может выполняться как на рабочем месте администратора с установленным менеджером конфигурации (МК), так и на стороннем рабочем месте. Если скрипт `convert_cp_to_c4.py` и МК находятся на разных РМ подразумевается, то сгенерированные файлы для импорта в МК необходимо будет перенести на РМ с установленным МК.

# Алгоритм работы

1. Запустите командную строку.
2. В командной строке перейдите в каталог, где распакован скрипт `convert_cp_to_c4.py`.
3. Запустите скрипт с помощью команды `python convert_cp_to_c4.py`.
4. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
5. Следуя инструкции, укажите путь до файла c объектами, содержащимися в правилах `*.с` (INPUT_OBJECTS).
6. Следуя инструкции, укажите путь до файла c правилами для преобразования в формате `*.fws` (INPUT_RULES).
7. Следуя инструкции, укажите путь до папки для сохранения преобразованного файла (OUTPUT_PATH).
8. При необходимости Вы можете сохранить копию лога работы со скриптом преобразования правил (LOG).
9. Следуя инструкции, укажите имя одной из политик, содержащихся в файле с правилами, для преобразования (POLICY_NAME).
10. При необходимости Вы можете скорректировать стандартное имя для преобразованного файла (NAME).
11. При необходимости Вы можете выполнить ограничение по количеству правил в файле, выполнив тем самым пользовательское разбиение преобразованного файла (NUM_RULE).

>**Примечание:** Скрипт самостоятельно ограничивает объем всех объектов ЦУС в одном преобразованном файле конфигурации в универсальном формате `*.json` числом 20000. Если введенное ограничение по количеству правил (NUM_RULE) будет противоречить максимально допустимому суммарному количеству всех объектов ЦУС в `*.json`, введенное пользователем ограничение по количеству правил будет проигнорировано и автоматически пересчитано и разделено с учетом количества объектов.

12. После ввода параметров согласно пунктам 5 - 11 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
13. Убедитесь, что по окончанию работы скрипта сгенерирован отчет о преобразовании объектов разных типов, включая правила, в командной строке.
14. Убедитесь, что по окончанию работы скрипта в папке для сохранения преобразованного файла лежит два файла:
    - файл, содержащий конфигурацию в универсальном формате *.json; 
    - отчет о результате операции импорта.

>**Примечание:** Если путь в параметрах не указан, файл с копией лога будет сохранен в директории, в которой скрипт был запущен. 

# Алгоритм импорта правил из различных систем в КБ "Континент. Версия 4" (далее – К4) через МК

1. Запустите МК.
2. Выполните подключение к ЦУС.
3. Перейдите в раздел "Контроль доступа – Межсетевой экран".
4. В пустой области секции "Межсетевой экран" используйте пункт "Импортировать" контекстного меню.
5. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
6. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_cp_to_c4.py`.
7. Нажмите кнопку "Открыть".
8. Дождитесь окончания импорта.
9. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
10. Ознакомьтесь с результатами выполнения импорта.
11. Перейдите в раздел "Контроль доступа – Трансляция сетевых адресов".
12. В пустой области секции "Трансляция сетевых адресов" используйте пункт "Импортировать" контекстного меню.
13. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
14. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_cp_to_c4.py`.
15. Нажмите кнопку "Открыть".
16. Дождитесь окончания импорта.
17. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
18. Ознакомьтесь с результатами выполнения импорта.

## Просмотр детальной информации о результатах импорта

1. Перейдите в раздел "Администрирование – Задачи".
2. Выберите в списке задачу "Импорт политики контроля доступа", соответствующую времени запуска и окончания импорта.
3. В окне "Информация" будет представлен отчет, содержащем сообщения о результатах операции импорта. Если окно не отображается, перейдите на вкладку "Вид" и активируйте кнопку "Информация". 

## Замечания для правил фильтрации

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от оригинального значения параметра "Disabled" в Check Point.
2. В описании каждого правила будут отражены следующие параметры:
    - описание объекта системы из Check Point;
    - значения параметров, которые не переносятся из Check Point в К4 или каким либо-образом трансформируются;
    - информация о наличии связей между объектами системы и сетевыми устройствами.
3. Если в качестве "Source" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Отправителя" будет установлено значение "Любой" / "Any".
4. Если в качестве "Destination" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Получателя" будет установлено значение "Любой" / "Any".
5. При импорте правил из Check Point в К4 не осуществляется перенос сетевых объектов, тип которых отличается от `host` / `network` / `machines_range` / `group`.
6. Если в качестве "Service" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Сервиса" будет установлено значение "Любой" / "Any".
7. При импорте правил из Check Point в К4 не осуществляется перенос сервисов с типом `DceRpc` или `icmpv6`.
8. При импорте правил из Check Point в К4 не осуществляется перенос других сервисов с протоколами `0` / `41` / `43` / `44` / `45` / `46` / `50` / `51` / `58` / `59` / `60`.
9. При импорте правил из Check Point в К4 параметр "Действие" / "Action" переносится согласно следующим правилам:
    - если в качестве "Action" на стороне Check Point указано значение "Accept", на стороне К4 для "Действия" будет установлено значение "Пропустить" / "Accept";
    - если в качестве "Action" на стороне Check Point указано значение "Reject", на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Drop";
    - если в качестве "Action" на стороне Check Point указано значение "Drop", на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Drop".
10. При импорте правил из Check Point в К4 не осуществляется перенос правил фильтрации, действие которых отличается от `accept` / `reject` / `drop`.
11. Если в качестве "Time" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Временного интервала" будет установлено значение "Всегда" / "Always".
12. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов с типом `scheduled_event` или `group`. 
13. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов, содержащих значение месяца и порядкового дня месяца в качестве старта или окончания временного интервала.
14. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов, содержащих значение месяца и порядкового дня месяца в качестве периода повторения работы временного интервала.
15. При импорте правил из Check Point в К4 параметр "Track" / "Лог" ("Log") переносится согласно следующим правилам:
    - если в качестве "Track" на стороне Check Point указано значение "Alert", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "Log", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "None", на стороне К4 не будет автоматически включено логирование работы правила (логирование выключено).
16. При импорте правил из Check Point в К4 не осуществляется перенос правил фильтрации, для которых параметр "Track" равен "Account".
17. В К4 не переносится параметр "VPN".
18. При импорте правил из Check Point в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию): 
    - Профиль Web/FTP фильтрации;
    - Приложение;
    - СОВ. 
19. Для сетевых объектов типа `host` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - SNMP;
    - Color;
    - FIreWall-1 GX;
    - IPv6 address;
    - OS.
20. Для сетевых объектов типа `network` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - Broadcast;
    - Color;
    - Network address (IPv6);
    - Prefix (IPv6).
21. Для сетевых объектов типа `machines_range` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - Color;
    - First IPv6 address;
    - Last IPv6 address.
22. Для сервисов типа `tcp` / `udp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable Aggressive Aging;
    - Aggressive Aging Timeout;
    - Protocol type;
    - Accept Peplies;
    - Match for "Any";
    - Synchronize connections on Cluster;
    - Start synchronizing;
    - Enable for TCP resource.
23. Для сервисов типа `other` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable Aggressive Aging;
    - Aggressive Aging Timeout;
    - Protocol type;
    - Accept Peplies;
    - Synchronize connections on Cluster.
24. Для сервисов типа `icmp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type.

## Замечания для правил трансляции

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от установленного значения параметра "Disabled" в Check Point.
2. В описании каждого правила будут отражены следующие параметры:
    - описание объекта системы из Check Point;
    - значения параметров, которые не переносятся из Check Point в К4 или каким либо-образом трансформируются;
    - информация о наличии связей между объектами системы и сетевыми устройствами.
3. Если в качестве "Source (Original)" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Отправителя (Исходный пакет)" будет установлено значение "Любой" / "Any".
4. Если в качестве "Destination (Original)" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Получателя (Исходный пакет)" будет установлено значение "Любой" / "Any".
5. При импорте правил из Check Point в К4 не осуществляется перенос сетевых объектов, тип которых отличается от `host` / `network` / `machines_range` / `group`.
6. Не осуществляется перенос правил, содержащих инвертированные сетевые объекты в качестве значения "Source (Original)" и/или "Destination (Original)".
7. Если в качестве "Service (Original)" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Сервиса (Исходный пакет)" будет установлено значение "Любой" / "Any".
8. При импорте правил из Check Point в К4 не осуществляется перенос сервисов с типом `DceRpc` или `icmpv6`.
9. При импорте правил из Check Point в К4 тип трансляции переносится согласно следующим правилам:
    - если на стороне Check Point значения "Source (Original)", "Destination (Original)" и "Service (Original)" соответственно равны значениям "Source (Translated)", "Destination (Original)", "Service (Translated)", на стороне К4 для "Трансляция" будет установлено значение "Не транслировать" / "No NAT";
    - если на стороне Check Point значения "Source (Original)" и "Source (Translated)" между собой не равны и значения "Destination (Original)" и "Destination (Translated)" равны, на стороне К4 для "Трансляция" будет установлено значение "Отправителя" / "Source";
    - если на стороне Check Point значения "Destination (Original)" и "Destination (Translated)" не равны и значения "Source (Original)" и "Source (Translated)" между собой не равны, на стороне К4 для "Трансляция" будет установлено значение "Получателя" / "Destination".
10. Не осуществляется перенос правил, для которых на стороне Check Point значения "Source (Original)" и "Source (Translated)" между собой не равны и значения "Destination (Original)" и "Destination (Translated)" между собой не равны.
11. Не осуществляется перенос правил, для которых на стороне Check Point значение "Service (Original)" равно "ANY" и значение "Service (Translated)" не равно "ANY".
12. Если в качестве "Service (Translated)" на стороне Check Point не указано ни одного объекта на стороне К4 для "Сервиса (Преобразованный пакет)" будет установлено значение "Любой" / "Any".
13. Не осуществляется перенос правил, для которых на стороне Check Point значения "Service (Original)" содержит протокол который отличается от `6` (TCP) или `17` (UDP).
14. Не осуществляется перенос правил, для которых на стороне Check Point значения "Service (Translated)" содержит протокол который отличается от `6` (TCP) или `17` (UDP).
15. Для сетевых объектов типа `host` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - SNMP;
    - Color;
    - FIreWall-1 GX;
    - IPv6 adress;
    - OS.
16. Для сетевых объектов типа `network` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - Broadcast;
    - Color;
    - Network address (IPv6);
    - Prefix (IPv6).
17. Для сетевых объектов типа `machines_range` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - NAT;
    - Color;
    - First IPv6 address;
    - Last IPv6 address.
18. Для сервисов типа `tcp` / `udp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable Aggressive Aging;
    - Aggressive Aging Timeout;
    - Protocol type;
    - Accept Peplies;
    - Match for "Any";
    - Synchronize connections on Cluster;
    - Start synchronizing;
    - Enable for TCP resource.
19. Для сервисов типа `other` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable Aggressive Aging;
    - Aggressive Aging Timeout;
    - Protocol type;
    - Accept Peplies;
    - Synchronize connections on Cluster.
20. Для сервисов типа `icmp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type.

## Список поддерживаемых типов/кодов сообщений ICMP

С полным перечнем типов/кодов, включая их описание, можно ознакомиться по [ссылке](https://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml)

| Номер типа | Номер кода |
|------------|------------|
| -          | -          |
| 0          | 0          |
| 3          | 0          |
| 3          | 1          |
| 3          | 2          |
| 3          | 3          |
| 3          | 4          |
| 3          | 5          |
| 3          | 6          |
| 3          | 7          |
| 3          | 8          |
| 3          | 9          |
| 3          | 10         |
| 3          | 11         |
| 3          | 12         |
| 3          | 13         |
| 3          | 14         |
| 3          | 15         |
| 4          | 0          |
| 5          | 0          |
| 5          | 1          |
| 5          | 2          |
| 5          | 3          |
| 6          | 0          |
| 8          | 0          |
| 9          | 0          |
| 9          | 16         |
| 10         | 0          |
| 11         | 0          |
| 11         | 1          |
| 12         | 0          |
| 12         | 1          |
| 12         | 2          |
| 13         | 0          |
| 14         | 0          |
| 15         | 0          |
| 16         | 0          |
| 17         | 0          |
| 18         | 0          |
| 30         | -          |
| 31         | -          |
| 32         | -          |
| 33         | -          |
| 34         | -          |
| 35         | -          |
| 36         | -          |
| 37         | -          |
| 38         | -          |
| 39         | -          |
| 40         | 0          |
| 40         | 1          |
| 40         | 2          |
| 40         | 3          |
| 40         | 4          |
| 40         | 5          |
| 41         | -          |
| 42         | 0          |
| 43         | 0          |
| 43         | 1          |
| 43         | 2          |
| 43         | 3          |
| 43         | 4          |

# Приложения

К инструменту прилагаются следующие материалы:

- `c4_unified_json.svg` - описание структуры (схема) импортируемых данных.
