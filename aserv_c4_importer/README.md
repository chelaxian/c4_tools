# Назначение инструмента

Импорт через API Континент 4 конфигурации СД Континент 3 в объеме, ограниченном универсальным форматом `*.json`, а именно:

- общие настройки СД;
- учетные записи пользователей;
- настройки удаленного доступа пользователей;
- корневые сертификаты, сертификаты СД, сертификаты пользователей;
- правила фильтрации;
- сетевые объекты;
- сервисы.

# Основные функции

1. Использование библиотеки `c4_lib` для работы с API Континент 4.
2. Импорт конфигурации СД Континент 3 в формате `*.json` на ЦУС Континент 4.
3. Вывод на экран справки по использованию инструмента.

> Рекомендуется конфигурацию одного СД Континент 3 импортировать на один СД Континент 4. 

# Алгоритм работы

1. Запустите командную строку.
2. Запустите скрипт с помощью команды `aserv_c4_importer`.
3. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
4. Следуя инструкции, укажите логин и пароль учетной записи **Главный администратор** (CREDS).
5. Следуя инструкции, укажите IP-адрес ЦУС Континент 4 (IP).
6. Следуя инструкции, укажите файл c конфигурацией СД Континент 3 в формате `*.json` (CONFIG).
7. Следуя инструкции, укажите имя СД Континент 4, в который будет перенесена конфигурация (NAME_ASERV).
8. При необходимости укажите имя файла логирования (LOG).
9. После ввода параметров согласно пунктам 5 - 9 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
10. Убедитесь, что по окончании работы скрипта сгенерирован отчет, содержащий детальную информацию о результатах импорта.

## Замечания при импорте конфигурации СД Континент 3 на СД Континент 4

1. Если в качестве "Получателя" правила фильтрации на стороне СД Континент 3 указан "клиент Континента", то такие правила не импортируются.
2. При импорте правил фильтрации из Континент 3 в Континент 4 параметр "Действие" для правил переносится с ограничениями. Запрет прохождения пакета для правил на стороне Континент 4 будет автоматически применяться, если на стороне Континент 3 в качестве характеристики действия установлены значения "Отбросить пакет" и "Отбросить пакет с уведомлением". При значении "Пропустить" будет включено разрешение на прохождения пакета. 
3. При импорте правил фильтрации из Континент 3 в Континент 4 параметр "Протоколирование" для правил переносится с ограничениями. Логирование для правил на стороне Континент 4 будет автоматически включено только в тех случаях, если на стороне Континент 3 в качестве характеристики регистрации установлены значения "Запись в журнал заголовка" и "Запись в журнал тела пакета". При прочих значениях для правил фильтрации на стороне К4 логирование не будет включено автоматически. 
4. При импорте конфигурации из Континент 3 в Континент 4 сервисы переносятся с ограничениями. Не импортируются сервисы с протоколами `sep`, `idrp`, `rsvp`, `mhrp`, `esp`, `ah`. Сервис с протоколом `carp` импортируется как сервис с протоколом `vrrp`. 
5. При импорте учетных записей пользователей на стороне Континент 4 автоматически генерируется пароль для каждой учетной записи. При необходимости администратор средствами МК может изменить пароль пользователя.
6. При импорте одинаковые правила удаленного доступа для одного пользователя с разными объектами доступа объединяются в одно правило.

## Замечания при импорте двух конфигураций СД Континент 3 на один СД Континент 4

1. Важно учесть порядок импорта конфигураций. В общих настройках СД Континент 4 будут сохранены общие настройки СД первой конфигурации.
2. При импорте второй конфигурации на СД Континент 4 уже импортированные значения не перезаписываются, но добавляются отсутствующие ранее:
- пулы адресов СД;
- учетные записи пользователей;
- правила удаленного доступа пользователей;
- корневые сертификаты, сертификаты СД, сертификаты пользователей;
- правила фильтрации;
- сетевые объекты;
- сервисы.
3. При дублировании учетной записи сертификат пользователя добавляется в список сертификатов пользователя.

# Приложения

К инструменту прилагаются следующие материалы:

- c3_json.svg - описание структуры (схема) импортируемых данных.
