# Используемые обозначения

ЦУС - Центр управления сетью.

УБ - Узел безопасности.

СД - Сервер доступа.

МК - Менеджер конфигурации.

АРМ - Автоматизированное рабочее место.

# Назначение инструмента

Импорт через API Континент 4 конфигурации СД Континент 3 в объеме, ограниченном универсальным форматом `*.json`, а именно:

- общие настройки СД;
- учетные записи пользователей;
- настройки удаленного доступа пользователей;
- корневые сертификаты, сертификаты СД, сертификаты пользователей;
- правила фильтрации;
- сетевые объекты;
- сервисы.

# Основные функции

1. Использование библиотеки `c4_lib` для работы с API Континент 4.
2. Импорт конфигурации СД Континент 3 в формате `*.json` на ЦУС Континент 4.
3. Вывод на экран справки по использованию инструмента.

# Основные характеристики

1. Инструмент представлен набором скриптов на языке Python.
2. Инструмент предоставляет пользователю интерфейс CLI.
3. Инструмент поставляется в виде архива `tar.gz`.
4. Инструмент содержит встроенную справку по использованию (ключи, параметры).
5. Инструмент доустанавливает необходимые для работы компоненты по зависимостям.

# Системные требования

1. АРМ пользователя под управлением ОС Linux.
2. Физический и логический сетевой доступ АРМ пользователя к ЦУС.
3. Установленные на АРМ пользователя интерпретатор Python последней версии.
4. Установленный на АРМ пользователя компонент `openssl` версии 3.0.
5. Наличие IP адреса АРМ пользователя в списке разрешенных для подключения к ЦУС.
6. Учетная запись Континент 4 с ролью **Главный администратор**.
7. Развернутый Континент 4 с включенным на УБ компонентом **Сервер доступа**.

# Инструкция по установке

1. Выполнить установку библиотеки `c4_lib`, если ранее это не было сделано.
2. Скачать архив `aserv_c4_importer-X.X.tar.gz`.
3. Распаковать скаченный архив в любую директорию.
4. Перейти в директорию, куда был распакован архив, затем - в директорию `aserv_c4_importer`, убедиться в наличии файла `setup.py`.
5. Выполнить команду `pip install . -f . --no-index` для установки компонентов, необходимых для работы инструмента.
6. Дождаться завершения установки компонентов, необходимых для работы инструмента.
7. В случае отсутствия пути до установленного инструмента в переменной окружения `PATH` пропишите его вручную (особенность дистрибутива ОС Linux).
8. Вызвать встроенную справку и ознакомиться с ее содержанием.
9. Инструмент готов к использованию.

# Подготовка к работе

1. Выполните экспорт конфигурации СД Континент 3 в формате `*.json`.
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `aserv_c4_importer.py`, разместив содержимое в любую директорию на АРМ пользователя.

>**Примечание:** Рекомендуется конфигурацию одного СД Континент 3 импортировать на один СД Континент 4. 

# Алгоритм работы

1. Запустите командную строку.
2. Запустите скрипт с помощью команды `aserv_c4_importer`.
3. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
4. Следуя инструкции, укажите логин и пароль учетной записи **Главный администратор** (CREDS).
5. Следуя инструкции, укажите IP-адрес ЦУС Континент 4 (IP).
6. Следуя инструкции, укажите файл c конфигурацией СД Континент 3 в формате `*.json` (CONFIG).
7. Следуя инструкции, укажите имя СД Континент 4, в который будет перенесена конфигурация (NAME_ASERV).
8. При необходимости укажите имя файла логирования (LOG).
9. После ввода параметров согласно пунктам 5 - 9 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
10. Убедитесь, что по окончании работы скрипта сгенерирован отчет, содержащий детальную информацию о результатах импорта.

## Замечания при импорте конфигурации СД Континент 3 на СД Континент 4

1. Если в качестве "Получателя" правила фильтрации на стороне СД Континент 3 указан "клиент Континента", то такие правила не импортируются.
2. При импорте правил фильтрации из Континент 3 в Континент 4 параметр "Действие" для правил переносится с ограничениями. Запрет прохождения пакета для правил на стороне Континент 4 будет автоматически применяться, если на стороне Континент 3 в качестве характеристики действия установлены значения "Отбросить пакет" и "Отбросить пакет с уведомлением". При значении "Пропустить" будет включено разрешение на прохождения пакета. 
3. При импорте правил фильтрации из Континент 3 в Континент 4 параметр "Протоколирование" для правил переносится с ограничениями. Логирование для правил на стороне Континент 4 будет автоматически включено только в тех случаях, если на стороне Континент 3 в качестве характеристики регистрации установлены значения "Запись в журнал заголовка" и "Запись в журнал тела пакета". При прочих значениях для правил фильтрации на стороне К4 логирование не будет включено автоматически. 
4. При импорте конфигурации из Континент 3 в Континент 4 сервисы переносятся с ограничениями. Не импортируются сервисы с протоколами `sep`, `idrp`, `rsvp`, `mhrp`, `esp`, `ah`. Сервис с протоколом `carp` импортируется как сервис с протоколом `vrrp`. 
5. При импорте учетных записей пользователей на стороне Континент 4 автоматически генерируется пароль для каждой учетной записи. При необходимости администратор средствами МК может изменить пароль пользователя.
6. При импорте одинаковые правила удаленного доступа для одного пользователя с разными объектами доступа объединяются в одно правило.

## Замечания при импорте двух конфигураций СД Континент 3 на один СД Континент 4

1. Важно учесть порядок импорта конфигураций. В общих настройках СД Континент 4 будут сохранены общие настройки СД первой конфигурации.
2. При импорте второй конфигурации на СД Континент 4 уже импортированные значения не перезаписываются, но добавляются отсутствующие ранее:
- пулы адресов СД;
- учетные записи пользователей;
- правила удаленного доступа пользователей;
- корневые сертификаты, сертификаты СД, сертификаты пользователей;
- правила фильтрации;
- сетевые объекты;
- сервисы.
3. При дублировании учетной записи сертификат пользователя добавляется в список сертификатов пользователя.

# Приложения

К инструменту прилагаются следующие материалы:

- c3_json.svg - описание структуры (схема) импортируемых данных.
