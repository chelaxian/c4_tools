# Назначение инструмента

Импорт через API Континент 4 правил фильтрации (FW) и правил трансляции (NAT), включая связанные с ними объекты по заданному в формате `*.xlsm` шаблону.

Инструмент можно использовать для загрузки предварительно созданной вручную политики и для миграции с решений других вендоров (при условии, что проработана выгрузка их конфигурации с приведением к установленному формату).

При редактировании содержимого шаблона необходимо сохранять оригинальную структуру таблиц и листов. Шаблон подразумевает в первую очередь создание объектов с последующим их назначением правилам.

> **Внимание!** Для упрощения процесса назначения объектов правилам шаблон обогащен макросами, использование которых необходимо разрешить (включить) при открытии файла шаблона. Макросы в шаблоне не преследуют цель воспроизвести функциональность МК, поэтому рекомендуется обращаться к ограничениям МК (валидациям) при формировании наполнения шаблона.

# Основные функции инструмента

1. Использование библиотеки `c4_lib` для работы с API Континент 4.
2. Создание или повторное использование необходимых согласно шаблону объектов (групп объектов).
3. Создание правил фильтрации и правил трансляции в порядке их следования в шаблоне.
4. Назначение им созданных ранее объектов (групп объектов).
5. Вывод на экран справки по использованию инструмента.

# Описание структуры шаблона

В качестве входных данных инструмент использует файл `*.xlsm` со следующими листами:

- `FwRule` - список правил FW;
- `NatRule` - список правил NAT;
- `NetObj` - список сетевых объектов;
- `NetObjGroup` - список групп сетевых объектов;
- `Service` - список сервисов;
- `ServiceGroup` - список групп сервисов;
- `Gateway` - список УБ.

Лист `FwRule` содержит следующие поля:

- `State` - состояние правила FW;
- `Name` - название правила FW;
- `Source` - список объектов-отправителей, предварительно заданных на листе `Netobj`;
- `Destination` - список объектов-получателей, предварительно заданных на листе `Netobj`;
- `Service` - список портовых сервисов, предварительно заданных на листе `Service`;
- `Gateway` - список УБ, предварительно заданных на листе `Gateway`;
- `Action` - действие при фильтрации;
- `Log` - признак логирования при сработке правила FW;
- `Description` - описание правила FW.

Лист `NatRule` содержит следующие поля:

- `State` - состояние правила NAT;
- `Name` - название правила NAT;
- `OrigSource` - список объектов-отправителей (до NAT), предварительно заданных на листе `NetObj`;
- `OrigDestination` - список объектов-получателей (до NAT), предварительно заданных на листе `NetObj`;
- `OrigService` - **портовый** сервис (до NAT) из списка предварительно заданных на листе `Service`;
- `TransSource` - объект-отправитель (после NAT) из списка предварительно заданных на листе `NetObj`;
- `TransDestination` - объект-получатель (после NAT) из списка предварительно заданных на листе `NetObj`;
- `TransService` - **портовый** сервис (после NAT) из списка предварительно заданных на листе `NetObj`;
- `Gateway` - список УБ, предварительно заданных на листе `Gateway`;
- `Type` - тип NAT;
- `Description` - описание правила NAT.

Лист `NetObj` содержит следующие поля:

- `Name` - название сетевого объекта;
- `Value` - адресные данные сетевого объекта;
- `Description` - описание сетевого объекта;
- `Group` - принадлежность к группе сетевых объектов.

Лист `NetObjGroup` содержит следующие поля:

- `Name` - название группы сетевых объектов;
- `Description` - описание группы сетевых объектов.

Лист `Service` содержит следующие поля:

- `Name` - название сервиса;
- `Value` - адресные данные сервиса;
- `Description` - описание сервиса;
- `Group` - принадлежность к группе сервисов.

Лист `ServiceGroup` содержит следующие поля:

- `Name` - название группы сервисов;
- `Description` - описание группы сервисов.

Лист `Gateway` содержит следующие поля:

- `Name` - название УБ (задается в МК);
- `Value` - идентификатор УБ (задается при установке ОС на платформу, хранится в конфигурации как `hwserial`).

## Описание полей листа `FwRule`

Для поля `FwRule.State` допустимо задание **одного** из следующих значений:

- `On` - правило FW включено;
- `Off` - правило FW выключено.

Для поля `FwRule.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `FwRule.Source` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- список объектов-отправителей, определенный путем выбора из предварительно заданных на листе `NetObj`.

Для поля `FwRule.Destination` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- список объектов-получателей, определенный путем выбора из предварительно заданных на листе `NetObj`.

Для поля `FwRule.Service` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- список **любых** сервисов, определенный путем выбора из предварительно заданных на листе `Service`.

Для поля `FwRule.Gateway` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Все` / `All` в МК (все УБ);
- список УБ, определенный путем выбора из предварительно заданных на листе `Gateway`.

Для поля `FwRule.Action` допустимо задание **одного** из следующих значений:

- `Allow` - пропустить трафик, подошедший под правило FW;
- `Block` - заблокировать (отбросить) трафик, подошедший под правило FW.

Для поля `FwRule.Log` допустимо задание **одного** из следующих значений:

- `Yes` - логировать сработку правила FW (регистрировать соответствующее событие в журнале сетевой безопасности);
- `No` - не логировать сработку правила FW.

Для поля `FwRule.Description` допустимо задание текстовой строки длиной не более `1024` символов.

## Описание полей листа `NatRule`

Для поля `NatRule.State` допустимо задание **одного** из следующих значений:

- `On` - правило NAT включено;
- `Off` - правило NAT выключено.

Для поля `NatRule.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `NatRule.OrigSource` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- список объектов-отправителей, определенный путем выбора из предварительно заданных на листе `NetObj`;
- объект-отправитель типа "Хост" (только для типа трансляции `Netmap`);
- объект-отправитель типа "Подсеть" (только для типа трансляции `Netmap`).

Для поля `NatRule.OrigDestination` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- список объектов-отправителей, определенный путем выбора из предварительно заданных на листе `NetObj`;
- объект-отправитель типа "Хост" (только для типов трансляции `Destination` и `Netmap`);
- объект-отправитель типа "Подсеть" (только для типа трансляции `Netmap`).

Для поля `NatRule.OrigService` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- **портовый** сервис с протоколом TCP;
- **портовый** сервис с протоколов UDP.

Для поля `NatRule.TransSource` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- объект-отправитель типа "Хост" (только для типов трансляции `Source` и `Netmap`);
- объект-отправитель типа "Подсеть" (только для типов трансляции `Source` и `Netmap`);
- объект-отправитель типа "Диапазон" (только для типа трансляции `Source`).

Для поля `NatRule.TransDestination` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- объект-отправитель типа "Хост" (только для типа трансляции `Destination`).

Для поля `NatRule.TransService` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Любой` / `Any` в МК;
- **портовый** сервис с протоколом TCP и заданным портом отправителя (только для типа трансляции `Source`);
- **портовый** сервис с протоколом UDP и заданным портом отправителя (только для типа трансляции `Source`);
- **портовый** сервис с протоколом TCP и заданным портом получателя (только для типа трансляции `Destination`);
- **портовый** сервис с протоколом UDP и заданным портом получателя (только для типа трансляции `Destination`).

Для поля `NatRule.Gateway` допустимо задание **одного** из следующих значений:

- пустой список, соответствует `Все` / `All` в МК (все УБ);
- список УБ, определенный путем выбора из предварительно заданных на листе `Gateway`. 

Для поля `NatRule.Type` допустимо задание **одного** из следующих значений:

- `Original` - для заданного классификатора не выполнять трансляцию;
- `Hide` - для заданного классификатора выполнять автоматическое скрытие адреса отправителя;
- `Source` - для заданного классификатора выполнять трансляцию адресных данных отправителя по заданной схеме (в том числе порта);
- `Destination` - для заданного классификатора выполнять трансляцию адресных данных получателя по заданной схеме (в том числе порта);
- `Netmap` - для заданного классификатора выполнять трансляцию адресных данных отправителя по схеме "адрес-в-адрес".

Для поля `NatRule.Description` допустимо задание текстовой строки длиной не более `1024` символов.

## Описание полей листа `NetObj`

Для поля `NetObj.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `NetObj.Value` допустимо задание **одного** из следующих значений:

- `AAA.BBB.CCC.DDD` - адресные данные объекта типа "Хост";
- `AAA.BBB.CCC.DDD-AAA.BBB.CCC.DDD` - адресные данные объекта типа "Диапазон";
- `AAA.BBB.CCC.DDD/MM` - адресные данные объекта типа "Подсеть".

Для поля `NetObj.Description` допустимо задание текстовой строки длиной не более `1024` символов.

Для поля `NetObj.Group` допустимо задание **одного** из следующих значений:

- пустой список, соответствует свободному сетевому объекту, не принадлежащему ни одногой группе;
- группа сетевых объектов, определенная путем выбора из предварительно заданных на листе `NetObjGroup`.

## Описание полей листа `NetObjGroup`

Для поля `NetObjGroup.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `NetObjGroup.Description` допустимо задание текстовой строки длиной не более `1024` символов.

## Описание полей листа `Service`

Для поля `Service.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `Service.Value` допустимо задание **одного** из следующих значений:

- `tcp/SPPPP/DPPPP` - **портовый** сервис с протоколом TCP и заданными портами отправителя и получателя соответственно;
- `tcp/SPPPP/-` - **портовый** сервис с протоколом TCP и заданным портом отправителя, порт получателя - любой;
- `tcp/-/DPPPP` - **портовый** сервис с протоколом TCP и заданным портом получателя, порт отправителя - любой;
- `tcp/-/-` - **портовый** сервис с протоколом TCP и любыми портами отправителя и получателя;
- `udp/SPPPP/DPPPP` - **портовый** сервис с протоколом UDP и заданными портами отправителя и получателя соответственно;
- `udp/SPPPP/-` - **портовый** сервис с протоколом UDP и заданным портом отправителя, порт получателя - любой;
- `udp/-/DPPPP` - **портовый** сервис с протоколом UDP и заданным портом получателя, порт отправителя - любой;
- `udp/-/-` - **портовый** сервис с протоколом UDP и любыми портами отправителя и получателя;
- `icmp/TT/CC` - сервис с протоколом ICMP и заданными типом и кодом сообщения ICMP;
- `icmp/TT/-` - сервис с протоколом ICMP и заданным типом сообщения ICMP, код сообщения - любой;
- `icmp/-/-` - сервис с протоколом ICMP и любыми типом и кодом сообщения ICMP;
- `ip/PPP` - сервис с протоколом IP и заданным номером протокола в заголовке IP пакета.

Для поля `Service.Description` допустимо задание текстовой строки длиной не более `1024` символов.

Для поля `Service.Group` допустимо задание **одного** из следующих значений:

- пустой список, соответствует свободному сервису, не принадлежащему ни одногой группе;
- группа сервисов, определенная путем выбора из предварительно заданных на листе `ServiceGroup`.

## Описание полей листа `ServiceGroup`

Для поля `ServiceGroup.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `ServiceGroup.Description` допустимо задание текстовой строки длиной не более `1024` символов.

## Описание полей листа `Gateway`

Для поля `Gateway.Name` допустимо задание текстовой строки длиной не более `128` символов.

Для поля `Gateway.Value` допустимо задание целочисленного значения в диапазоне от `0` до `4294967295`.
