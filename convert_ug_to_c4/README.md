# Подготовка к работе

1. Штатным образом выполните подключение к UserGate и извлеките файл активной конфигурации.
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `convert_ug_to_c4.py`, разместив содержимое в любой каталог на рабочем месте (РМ) администратора.

>**Внимание:** Запуск скрипта `convert_ug_to_c4.py` может выполняться как на рабочем месте администратора с установленным менеджером конфигурации (МК), так и на стороннем рабочем месте. Если скрипт `convert_ug_to_c4.py` и МК находятся на разных РМ подразумевается, то сгенерированные файлы для импорта в МК необходимо будет перенести на РМ с установленным МК.

# Алгоритм работы

1. Запустите командную строку.
2. В командной строке перейдите в каталог, где распакован скрипт `convert_ug_to_c4.py`.
3. Запустите скрипт с помощью команды `python convert_ug_to_c4.py`.
4. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
5. Следуя инструкции, укажите путь до директории c конфигурацией (`-i <INPUT>`).
6. Следуя инструкции, укажите путь до папки для сохранения преобразованной конфигурации (`-o <OUTPUT_PATH>`).
7. При необходимости Вы можете сохранить копию лога работы со скриптом преобразования правил по определённому пути (`--log_file <LOG_FILE>`).
8. При необходимости Вы можете скорректировать префикс для преобразованного файла (`--name <NAME>`).
9. При необходимости Вы можете указать ограничение по количеству правил в одном файле (`--num_rule <NUM_RULE>`).

>**Примечание:** Скрипт самостоятельно ограничивает объем всех объектов ЦУС в одном преобразованном файле конфигурации в универсальном формате `*.json` числом 20000. Если введенное ограничение по количеству правил `<NUM_RULE>` будет противоречить максимально допустимому суммарному количеству всех объектов ЦУС в `*.json`, введенное пользователем ограничение по количеству правил будет проигнорировано и автоматически пересчитано и разделено с учетом количества объектов.

10. После ввода параметров согласно пунктам 5 - 9 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
11. Убедитесь, что по окончанию работы скрипта сгенерирован отчет о преобразовании объектов разных типов, включая правила, в командной строке.
12. Убедитесь, что по окончанию работы скрипта в папке для сохранения преобразованного файла лежит два файла:
    - файл, содержащий конфигурацию в универсальном формате `*.json`;
    - отчет о результате операции импорта.

>**Примечание:** Если путь для файла лога в параметрах не указан, он будет сохранен в директории, в которой был запущен скрипт.

# Алгоритм импорта правил из различных систем в КБ "Континент. Версия 4" (далее – К4) через МК

1. Запустите МК.
2. Выполните подключение к ЦУС.
3. Перейдите в раздел "Контроль доступа – Межсетевой экран".
4. В пустой области секции "Межсетевой экран" используйте пункт "Импортировать" контекстного меню.
5. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
6. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_ug_to_c4.py`.

>**Примечание:** Если у Вас имеется несколько конфигурационных файлов с пометками `-fw`, `-fw1`, `-fw2`, `-fw3`, такие файлы нужно будет загрузить соблюдая числовую последовательность из пометки в имени. Это необходимо для сохранения исходной структуры правил при переносе в новую Систему.

7. Нажмите кнопку "Открыть".
8. Дождитесь окончания импорта.
9.  После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
10. Ознакомьтесь с результатами выполнения импорта.
11. Перейдите в раздел "Контроль доступа – Трансляция сетевых адресов".
12. В пустой области секции "Трансляция сетевых адресов" используйте пункт "Импортировать" контекстного меню.
13. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
14. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_ug_to_c4.py`.

>**Примечание:** Если у Вас имеется несколько конфигурационных файлов с пометками `-nat`, `-nat1`, такие файлы нужно будет загрузить соблюдая числовую последовательность из пометки в имени. Это необходимо для сохранения исходной структуры правил при переносе в новую Систему.

15. Нажмите кнопку "Открыть".
16. Дождитесь окончания импорта.
17. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
18. Ознакомьтесь с результатами выполнения импорта.

## Просмотр детальной информации о результатах импорта

1. Перейдите в раздел "Администрирование – Задачи".
2. Выберите в списке задачу "Импорт политики контроля доступа", соответствующую времени запуска и окончания импорта.
3. В окне "Информация" будет представлен отчет, содержащем сообщения о результатах операции импорта. Если окно не отображается, перейдите на вкладку "Вид" и активируйте кнопку "Информация".

## Замечания для правил фильтрации

1. Все импортированные правила на стороне К4 будут отключены.
2. Если на стороне UserGate не указан номер порта, на стороне К4 для "Сервиса" будет установлено значение "Любой" / "Any".
3. При импорте правил из UserGate в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию):
    - Профиль Web/FTP фильтрации;
    - Приложение;
    - СОВ.
4. При импорте правил из UserGate в К4 параметр "Действие" / "Action" переносится согласно следующим правилам:
    - если на стороне UserGate указано значение `accept`, на стороне К4 будет установлено значение "Пропустить" / "Accept";
    - в остальных случаях на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Block".

## Замечания для правил трансляции

1. Все импортированные правила на стороне К4 будут отключены.
2. Не осуществляется перенос правил, для которых на стороне UserGate поля сервиса или транслированного сервиса содержат протокол, который отличается от `6` (TCP) или `17` (UDP).
3. Не осуществляется перенос правил DNAT, для которых в назначении исходного пакета установлена группа сетевых объектов.
4. Не осуществляется перенос правил DNAT, для которых в назначении исходного пакета установлен диапазон.
5. Не осуществляется перенос правил "Network mapping", для которых не установлены адреса или подсети источника исходного и транслированного пакета.
6. Не осуществляется перенос правил "Network mapping", в которых используются группы сетевых объектов или диапазоны.
7. Не осуществляется перенос правил, в которых используются группы сервисов.
8. Опция "включить SNAT" не поддерживатся и игнорируется.

# Приложения

К инструменту прилагаются следующие материалы:

- `c4_unified_json.svg` - описание структуры (схема) импортируемых данных.
