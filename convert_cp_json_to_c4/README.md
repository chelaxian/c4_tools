# Подготовка к работе

1. С помощью инструмента Check Point "Show Package Tool" скачайте файлы конфигурации в кодировке UTF-8 (файлы с правилами в формате `*.json` и объектами в формате `*.json`). 
2. Скачайте и установите последнюю версию интерпретатора Python.
3. Выполните распаковку скрипта `convert_cp_json_to_c4.py`, разместив содержимое в любой каталог на рабочем месте (РМ) администратора.

>**Внимание:** Запуск скрипта `convert_cp_json_to_c4.py` может выполняться как на рабочем месте администратора с установленным менеджером конфигурации (МК), так и на стороннем рабочем месте. Если скрипт `convert_cp_json_to_c4.py` и МК находятся на разных РМ подразумевается, то сгенерированные файлы для импорта в МК необходимо будет перенести на РМ с установленным МК.

# Алгоритм работы

1. Запустите командную строку.
2. В командной строке перейдите в каталог, где распакован скрипт `convert_cp_json_to_c4.py`.
3. Запустите скрипт с помощью команды `python convert_cp_json_to_c4.py`.
4. На экран будет выведено руководство по использованию скрипта. Ознакомьтесь с руководством!
5. Следуя инструкции, укажите путь до файла c объектами, содержащимися в правилах `*.json`. Укажите путь до файла c правилами для преобразования в формате `*.json` (INPUT).
6. Следуя инструкции, укажите путь до папки для сохранения преобразованного файла (OUTPUT_PATH).
7. При необходимости Вы можете сохранить копию лога работы со скриптом преобразования правил (LOG).
8. При необходимости Вы можете скорректировать стандартное имя для преобразованного файла (NAME).
9. При необходимости Вы можете осуществить вывод отладочной информации для преобразованного файла (--debug).

>**Примечание:** Опцией `--debug` следует пользоваться только при обнаружении, локализации и устранении ошибок. Данный ключ обогащает преобразованную конфигурацию служебными полями, а также добавляет информацию в файл копии лога, который задается с помощью `--log`.

11. После ввода параметров согласно пунктам 5 - 9 подтвердите запуск процедуры преобразования с помощью клавиши клавиатуры "Enter".
12. Убедитесь, что по окончанию работы скрипта сгенерирован отчет о преобразовании объектов разных типов, включая правила, в командной строке.
13. Убедитесь, что по окончанию работы скрипта в папке для сохранения преобразованного файла лежит два файла:
    - файл, содержащий конфигурацию в универсальном формате *.json; 
    - отчет о результате операции импорта.

>**Примечание:** Преобразованный файл конфигурации в универсальном формате `*.json` в имени содержит пометку `-nat` или `-fw`. В одном файле конфигурации могут содержаться или правила фильтрации и связанные с ними объекты или правила трансляции и связанные с ними объекты. Одновременного участия правил фильтрации и правил трансляции в одном конфигурационном файле не предусмотрено.

>**Примечание:** Правила фильтрации, которые выступали как вложенные правила или слои преобразуются отдельно. Их файл конфигурации в универсальном формате `*.json` в имени содержит пометку `-fw`. Рекомендуется выполнять загрузку правил вложенных правил или слоев после файла конфигурации с основными правилами фильтрации.

>**Примечание:** Если путь в параметрах не указан, файл с копией лога будет сохранен в директории, в которой скрипт был запущен. 

# Алгоритм импорта правил из различных систем в КБ "Континент. Версия 4" (далее – К4) через МК

1. Запустите МК.
2. Выполните подключение к ЦУС.
3. Перейдите в раздел "Контроль доступа – Межсетевой экран".
4. В пустой области секции "Межсетевой экран" используйте пункт "Импортировать" контекстного меню.
5. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
9. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_cp_json_to_c4.py`. Файл должен содержать в имени пометку `-fw`.
10. Нажмите кнопку "Открыть".
11. Дождитесь окончания импорта.
12. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
13. Ознакомьтесь с результатами выполнения импорта.
14. Перейдите в раздел "Контроль доступа – Трансляция сетевых адресов".
15. В пустой области секции "Трансляция сетевых адресов" используйте пункт "Импортировать" контекстного меню.
16. Будет выведено диалоговое окно для выбора файла конфигурации из внешней системы.
17. Выберите файл конфигурации в универсальном формате `*.json`, сгенерированный ранее скриптом `convert_cp_json_to_c4.py`.  Файл должен содержать в имени пометку `-nat`.
18. Нажмите кнопку "Открыть".
19. Дождитесь окончания импорта.
20. После завершения операции импорта будет выведено информационное сообщение о результате выполнения импорта.
21. Ознакомьтесь с результатами выполнения импорта.

## Просмотр детальной информации о результатах импорта

1. Перейдите в раздел "Администрирование – Задачи".
2. Выберите в списке задачу "Импорт политики контроля доступа", соответствующую времени запуска и окончания импорта.
3. В окне "Информация" будет представлен отчет, содержащем сообщения о результатах операции импорта. Если окно не отображается, перейдите на вкладку "Вид" и активируйте кнопку "Информация". 

## Замечания для правил фильтрации

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от оригинального значения параметра "Enabled" в Check Point.
2. В описании каждого правила будет отражено описание объекта системы из Check Point.
3. Если в качестве "Source" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Отправителя" будет установлено значение "Любой" / "Any".
4. Если в качестве "Destination" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Получателя" будет установлено значение "Любой" / "Any".
5. При импорте правил из Check Point в К4 не осуществляется перенос сетевых объектов, тип которых отличается от `host` / `network` / `address-range` / `group`.
6. Если в качестве "Service" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Сервиса" будет установлено значение "Любой" / "Any".
7. При импорте правил из Check Point в К4 не осуществляется перенос сервисов с типом `DceRpc` или `icmpv6`.
8. При импорте правил из Check Point в К4 не осуществляется перенос других сервисов с протоколами `0` / `41` / `43` / `44` / `45` / `46` / `50` / `51` / `58` / `59` / `60`.
9. При импорте правил из Check Point в К4 не осуществляется перенос ICMP сервисов с кодами и типами противоречащими [RFC792](https://www.rfc-editor.org/search/rfc_search_detail.php?rfc=792) и [IANA](https://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml).
10. При импорте правил из Check Point в К4 параметр "Действие" / "Action" переносится согласно следующим правилам:
    - если в качестве "Action" на стороне Check Point указано значение "Accept", на стороне К4 для "Действия" будет установлено значение "Пропустить" / "Accept";
    - если в качестве "Action" на стороне Check Point указано значение "Reject", на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Drop";
    - если в качестве "Action" на стороне Check Point указано значение "Drop", на стороне К4 для "Действия" будет установлено значение "Отбросить" / "Drop".
11. При импорте правил из Check Point в К4 не осуществляется перенос правил фильтрации, действие которых отличается от `accept` / `reject` / `drop`.
12. Если в качестве "Time" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Временного интервала" будет установлено значение "Всегда" / "Always".
13. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов с типом `time-group`. 
14. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов, содержащих значение месяца и порядкового дня месяца в качестве старта или окончания временного интервала.
15. При импорте правил из Check Point в К4 не осуществляется перенос временных объектов, содержащих значение месяца и порядкового дня месяца в качестве периода повторения работы временного интервала.
16. При импорте правил из Check Point в К4 параметр "Track" / "Лог" ("Log") переносится согласно следующим правилам:
    - если в качестве "Track" на стороне Check Point указано значение "None", на стороне К4 не будет автоматически включено логирование работы правила (логирование выключено);
    - если в качестве "Track" на стороне Check Point указано значение "Alert", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "Snmp", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "Mail", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "User alert 1", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "User alert 2", на стороне К4 будет автоматически включено логирование работы правила;
    - если в качестве "Track" на стороне Check Point указано значение "User alert 3", на стороне К4 будет автоматически включено логирование работы правила.
17. При импорте правил из Check Point в К4 не осуществляется перенос правил фильтрации, если в качестве "Track" на стороне Check Point включено логирование работы правила, а также активирован чекбокс "Accounting".
18. При импорте правил из Check Point в К4 не осуществляется перенос правил фильтрации, имеющие вложенные слои. 
19. При импорте правил из Check Point в К4 перенос вложенных правил фильтрации осуществляется отдельно от основных правил фильтрации.
20. При импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Hits;
    - VPN;
    - Content.
21. При импорте правил из Check Point в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию): 
    - Профиль Web/FTP фильтрации;
    - Приложение;
    - СОВ. 
22. Для сетевых объектов типа `host` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - IPv6 address;
    - NAT;
    - Advanced (SNMP);
    - Servers cоnfiguration.
23. Для сетевых объектов типа `network` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Broadcast address;
    - Network address (IPv6);
    - Prefix (IPv6);
    - NAT.
24. Для сетевых объектов типа `address-range` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - First IPv6 address;
    - Last IPv6 address;
    - NAT.
25. Для сервисов типа `tcp` / `udp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable for TCP resource;
    - Match for "Any";
    - Virtual session timeout;
    - Aggressive Aging;
    - Cluster and synchronization.
26. Для сервисов типа `other` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type;
    - Match;
    - Action;
    - Accept Peplies;
    - Virtual session timeout;
    - Aggressive Aging;
    - Cluster and synchronization.
27. Для сервисов типа `icmp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type.

## Замечания для правил трансляции

1. Все импортированные правила на стороне К4 будут отключены вне зависимости от установленного значения параметра "Disabled" в Check Point.
2. В описании каждого правила будут отражены следующие параметры:
    - описание объекта системы из Check Point;
    - значения параметров, которые не переносятся из Check Point в К4 или каким либо-образом трансформируются;
    - информация о наличии связей между объектами системы и сетевыми устройствами.
3. Если в качестве "Source (Original)" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Отправителя (Исходный пакет)" будет установлено значение "Любой" / "Any".
4. Если в качестве "Destination (Original)" на стороне Check Point не указано ни одного сетевого объекта, на стороне К4 для "Получателя (Исходный пакет)" будет установлено значение "Любой" / "Any".
5. При импорте правил из Check Point в К4 не осуществляется перенос сетевых объектов, тип которых отличается от `host` / `network` / `address-range` / `group`.
6. Не осуществляется перенос правил, содержащих инвертированные сетевые объекты в качестве значения "Source (Original)" и/или "Destination (Original)".
7. Если в качестве "Service (Original)" на стороне Check Point не указано ни одного объекта, на стороне К4 для "Сервиса (Исходный пакет)" будет установлено значение "Любой" / "Any".
8. При импорте правил из Check Point в К4 не осуществляется перенос сервисов с типом `DceRpc` или `icmpv6`.
9. При импорте правил из Check Point в К4 тип трансляции переносится согласно следующим правилам:
    - если на стороне Check Point значения "Source (Original)", "Destination (Original)" и "Service (Original)" соответственно равны значениям "Source (Translated)", "Destination (Original)", "Service (Translated)", на стороне К4 для "Трансляция" будет установлено значение "Не транслировать" / "No NAT";
    - если на стороне Check Point значения "Source (Original)" и "Source (Translated)" между собой не равны и значения "Destination (Original)" и "Destination (Translated)" равны, на стороне К4 для "Трансляция" будет установлено значение "Отправителя" / "Source";
    - если на стороне Check Point значения "Destination (Original)" и "Destination (Translated)" не равны и значения "Source (Original)" и "Source (Translated)" между собой не равны, на стороне К4 для "Трансляция" будет установлено значение "Получателя" / "Destination".
10. Не осуществляется перенос правил, для которых на стороне Check Point значения "Source (Original)" и "Source (Translated)" между собой не равны и значения "Destination (Original)" и "Destination (Translated)" между собой не равны.
11. Не осуществляется перенос правил, для которых на стороне Check Point значение "Service (Original)" равно "ANY" и значение "Service (Translated)" не равно "ANY".
12. Если в качестве "Service (Translated)" на стороне Check Point не указано ни одного объекта на стороне К4 для "Сервиса (Преобразованный пакет)" будет установлено значение "Любой" / "Any".
13. Не осуществляется перенос правил, для которых на стороне Check Point значения "Service (Original)" содержит протокол который отличается от `6` (TCP) или `17` (UDP).
14. Не осуществляется перенос правил, для которых на стороне Check Point значения "Service (Translated)" содержит протокол который отличается от `6` (TCP) или `17` (UDP).
15. При импорте правил из Check Point в К4 будут добавлены следующие необходимые для корректной работы системы параметры (для этих параметров на стороне К4 будут установлены значения по умолчанию): 
    - Профиль Web/FTP фильтрации;
    - Приложение;
    - СОВ.
16. Для сетевых объектов типа `host` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - IPv6 address;
    - NAT;
    - Advanced (SNMP);
    - Servers cоnfiguration.
17. Для сетевых объектов типа `network` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Broadcast address;
    - Network address (IPv6);
    - Prefix (IPv6);
    - NAT.
18. Для сетевых объектов типа `address-range` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - First IPv6 address;
    - Last IPv6 address;
    - NAT.
19. Для сервисов типа `tcp` / `udp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Enable for TCP resource;
    - Match for "Any";
    - Protocol type;
    - Virtual session timeout;
    - Aggressive Aging;
    - Cluster and synchronization.
20. Для сервисов типа `other` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type;
    - Match;
    - Action;
    - Accept Peplies;
    - Virtual session timeout;
    - Aggressive Aging;
    - Cluster and synchronization.
21. Для сервисов типа `icmp` при импорте правил из Check Point в К4 не осуществляется перенос следующих параметров: 
    - Color;
    - Protocol type.
